# 接口文档

## 统一 Response 结构

```json
{
    "status": "int, 状态码",
    "message": "String, Debug信息",
    "data": {}
}
```

## 前后端接口

### 用户注册

- **URL**: `/register`
- **Method**: POST
- **Request Body**:

    ```json
    {
        "data": {
            "username": "string, 用户名",
            "email": "string, 用户邮箱",
            "password": "string, 密码"
        }
    }
    ```

- **Responses**:
  - `200`: 注册成功
  - `400` 邮箱格式不合法
  - `409`: 邮箱已存在

### 用户登录

- **URL**: `/login`
- **Method**: POST
- **Request Body**:

    ```json
    {
        "data": {
            "email": "string, 用户邮箱",
            "password": "string, 用户密码",
            "public_key": "string, 用户公钥"
        }
    }
    ```

- **Responses**:
  
  - `200`: 登录成功，附带 token
  
    ```json
    {
        "status": "integer, 状态码",
        "data": {
            "token": "string, 登陆token",
            "expires": "time, token过期时间"
        }
    }
    ```
  
  - `404`: 邮箱不存在
  
  - `401`: 密码错误

### 添加好友

- **URL**: `/contacts`

- **Method**: POST

- **Request Body**:

  ```json
  {
      "data": {
          "email": "string, 用户邮箱",
      }
  }
  ```

- **Responses**:

  - `200`: 删除成功

### 删除好友

- **URL**: `/contacts`

- **Method**: DELETE

- **Request Body**:

  ```json
  {
      "data": {
          "email": "string, 用户邮箱",
      }
  }
  ```

- **Responses**:

  - `200`: 删除成功


### 获取通讯录

- **URL**: `/contacts`
- **Method**: GET
- **Response**:
  
  - `200` : 获取成功，附带通讯录结构
  
    ```json
    {
        "status": "integer, 状态码",
        "data": {
            "contacts": [
                {
                    "email": "string, 用户邮箱",
                    "name": "string, 用户姓名",
                    "flag": "bool, 好友状态位"
                }
            ]
        }
    }
    ```


### 获取聊天历史

- **URL**: `/history`
- **Method**: POST
- **Request Body**:

    ```json
    {
        "data": {
            "email": "string, 邮箱"
        }
    }
    ```

- **Response**: `200` 附带消息结构数组

    ```json
    {
        "status": "integer, 状态码",
        "data": {
            "length": "int, 消息数组长度",
            "messages": [
                {
                    "timestamp": "int, Unix时间戳",
                    "message": {
                        "type": "string, 消息类型['text','picture']",
                        "content": "string, 消息内容"
                    },
                    "sender": "string, 发送者邮箱",
                    "receiver": "string, 接收者邮箱"
                }
            ]
        }
    }
    ```

### 发送消息

- **URL**: `/chat`
- **Method**: POST
- **Request Body**: 消息结构

    ```json
    {
        "data": {
            "timestamp": "int, Unix时间戳",
            "message": {
                "type": "string, 消息类型['text','picture']",
                "content": "string, 消息内容"
            },
            "sender": "string, 发送者邮箱",
            "receiver": "string, 接收者邮箱"
        }
    }
    ```

- **Response**:
  - `200`: 发送成功
  - `404`: 发送失败

## C/S 接口文档

### 用户注册

- 直接转发至服务端

### 用户登录

- 直接转发至服务端

### 用户获取通讯录

- 直接转发至服务端

### 检查在线状态

- **URL**: `/user/status`
- **Method**: POST
- **Request Body**:

    ```json
    {
        "data": {
            "email": "string, 目标用户邮箱"
        }
    }
    ```

- **Responses**:
  - `200`: 用户在线
  - `404`: 用户离线

### 获取用户公钥

- **URL**: `/user/public_key`
- **Method**: POST
- **Request Body**:

    ```json
    {
        "data": {
            "email": "string, 目标用户邮箱"
        }
    }
    ```

- **Response**:
  - `200` 带公钥数据

    ```json
    {
        "status": "integer, 状态码",
        "data": {
            "public_key": "string, 目标用户公钥"
        }
    }
    ```

### 验证用户存在

- **URL**: `/user/exists`
- **Method**: POST
- **Request Body**:

    ```json
    {
        "data": {
            "email": "string, 待验证邮箱"
        }
    }
    ```

- **Responses**:
  - `200`: 用户存在
  - `404`: 用户不存在

## P2P 接口文档

- 发送消息/接收消息
  - 使用 socket 点到点通信

  - 发送者从服务端获取接收者公钥
  
  - 发送者生成对称密钥，使用 RSA 与对方进行对称密钥协商
  
  - 将消息使用 AES 加密后发送
